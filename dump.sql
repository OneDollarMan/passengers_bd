CREATE SCHEMA `passenger`;
USE `passenger` ;
CREATE TABLE IF NOT EXISTS `bus` ( `id` INT NOT NULL AUTO_INCREMENT, `brand` VARCHAR(45) NOT NULL, `model` VARCHAR(45) NOT NULL, `plate` VARCHAR(45) NOT NULL, `year` INT NOT NULL, `mileage` FLOAT NOT NULL, `hidden` INT NOT NULL DEFAULT '0', PRIMARY KEY (`id`)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `role` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, PRIMARY KEY (`id`)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `user` ( `id` INT NOT NULL AUTO_INCREMENT, `fio` VARCHAR(45) NOT NULL, `birthday` DATE NOT NULL, `address` VARCHAR(45) NOT NULL, `phone` VARCHAR(45) NOT NULL, `hiring_date` DATE NOT NULL, `username` VARCHAR(45) NOT NULL, `password` VARCHAR(45) NOT NULL, `role_id` INT NOT NULL, `hidden` INT NOT NULL DEFAULT '0', PRIMARY KEY (`id`), INDEX `fk_user_role_idx` (`role_id` ASC) VISIBLE, CONSTRAINT `fk_user_role` FOREIGN KEY (`role_id`) REFERENCES `role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `route` ( `id` INT NOT NULL AUTO_INCREMENT, `number` INT NOT NULL, `length` FLOAT NOT NULL, `hidden` INT NOT NULL DEFAULT '0', PRIMARY KEY (`id`)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `status` ( `id` INT NOT NULL, `name` VARCHAR(45) NOT NULL, PRIMARY KEY (`id`)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `list` ( `id` INT NOT NULL AUTO_INCREMENT, `date` DATE NOT NULL, `route_id` INT NOT NULL, `bus_id` INT NOT NULL, `driver_id` INT NOT NULL, `conductor_id` INT NOT NULL, `status_id` INT NOT NULL DEFAULT '1', PRIMARY KEY (`id`), INDEX `fk_list_route1_idx` (`route_id` ASC) VISIBLE, INDEX `fk_list_bus1_idx` (`bus_id` ASC) VISIBLE, INDEX `fk_list_user1_idx` (`driver_id` ASC) VISIBLE, INDEX `fk_list_user2_idx` (`conductor_id` ASC) VISIBLE, INDEX `fk_list_status1_idx` (`status_id` ASC) VISIBLE, CONSTRAINT `fk_list_route1` FOREIGN KEY (`route_id`) REFERENCES `route` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_list_bus1` FOREIGN KEY (`bus_id`) REFERENCES `bus` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_list_user1` FOREIGN KEY (`driver_id`) REFERENCES `user` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_list_user2` FOREIGN KEY (`conductor_id`) REFERENCES `user` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_list_status1` FOREIGN KEY (`status_id`) REFERENCES `status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `flight` ( `id` INT NOT NULL AUTO_INCREMENT, `start_time` TIME NOT NULL, `end_time` TIME NOT NULL, `list_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_flight_list1_idx` (`list_id` ASC) VISIBLE, CONSTRAINT `fk_flight_list1` FOREIGN KEY (`list_id`) REFERENCES `list` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `stop` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, `address` VARCHAR(45) NOT NULL, PRIMARY KEY (`id`)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `route_has_stop` ( `route_id` INT NOT NULL, `stop_id` INT NOT NULL, PRIMARY KEY (`route_id`, `stop_id`), INDEX `fk_route_has_stop_stop1_idx` (`stop_id` ASC) VISIBLE, INDEX `fk_route_has_stop_route1_idx` (`route_id` ASC) VISIBLE, CONSTRAINT `fk_route_has_stop_route1` FOREIGN KEY (`route_id`) REFERENCES `route` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_route_has_stop_stop1` FOREIGN KEY (`stop_id`) REFERENCES `stop` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
INSERT INTO `role` VALUES (1,'Водитель'),(2,'Инженер-механик'),(3, 'Администратор');
INSERT INTO `user` VALUES (1,'root','1970-01-01','root','root','1970-01-01','root','63a9f0ea7bb98050796b649e85481845',3,0);
INSERT INTO `status` VALUES (1,'Новый'),(2,'В пути'),(3,'Завершен');